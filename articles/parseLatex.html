<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The parseLatex package • parseLatex</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The parseLatex package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parseLatex</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/parseLatex.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dmurdoch/parseLatex/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>The parseLatex package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dmurdoch/parseLatex/blob/main/vignettes/parseLatex.Rmd" class="external-link"><code>vignettes/parseLatex.Rmd</code></a></small>
      <div class="d-none name"><code>parseLatex.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Parsing LaTeX is tricky, because LaTeX macros (in LaTeX packages, or
in user code) can change the parsing rules as they go.</p>
<p><code>parseLatex</code> is not a LaTeX interpreter (at least mostly
it isn’t, but see the detailed comparison below), so it can’t do that:
it uses the same parsing rules for all code that it looks at. If you’re
using a LaTeX package that uses non-standard rules, you can use those,
but they have to apply to the whole section of code passed to
<code><a href="../reference/parseLatex_fn.html">parseLatex()</a></code>.</p>
<p>Subject to the limitation that the code only uses one set of rules,
<code>parseLatex</code> should be able to parse any LaTeX code. It
extends the base <code><a href="https://rdrr.io/r/tools/parseLatex.html" class="external-link">tools::parseLatex()</a></code> function in a few
ways:</p>
<ol style="list-style-type: decimal">
<li>It classifies every character in the source file according to TeX
“catcodes”. The base function only handles some of them.</li>
<li>The <code><a href="../reference/parseLatex_fn.html">parseLatex::parseLatex()</a></code> function marks its output
with class <code>"LaTeX2"</code> instead of <code>"LaTeX"</code>, and
marks each item in the output with class <code>"LaTeX2item"</code>. This
allows it to print things in a more readable way.</li>
<li>The <code>parseLatex</code> package includes a large selection of
functions for extracting and modifying parts of the parsed LaTeX.</li>
</ol>
<p>More differences are listed below.</p>
</div>
<div class="section level2">
<h2 id="demo">Demo<a class="anchor" aria-label="anchor" href="#demo"></a>
</h2>
<p>A simple demonstration is in order.</p>
<p>First, we use <code>knitr</code> to create a LaTeX table.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="va">latex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, format <span class="op">=</span> <span class="st">"latex"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">latex</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; \begin{tabular}{l|r|r}</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt;   &amp; mpg &amp; cyl\\</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt; Mazda RX4 &amp; 21 &amp; 6\\</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag &amp; 21 &amp; 6\\</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt; \end{tabular}</span></span></code></pre></div>
<p>Next, we parse it in <code>parseLatex</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmurdoch/parseLatex" class="external-link">parseLatex</a></span><span class="op">)</span></span>
<span><span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parseLatex_fn.html">parseLatex</a></span><span class="op">(</span><span class="va">latex</span><span class="op">)</span></span></code></pre></div>
<p>Printing the result would appear to duplicate the input, but in fact
it is quite different. <code>parsed</code> is a list of class
<code>"LaTeX2"</code>. Items in the list are of class
<code>"LaTeX2item"</code>. In this example, there are only two items:
the blank that <code>knitr</code> puts at the beginning of each table,
and a second entry which is the whole table environment:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parsed</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; SPECIAL:</span></span>
<span><span class="va">parsed</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; ENVIRONMENT: \begin{tabular}{l|r|r}</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt;   &amp; mpg &amp; cyl\\</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt; Mazda RX4 &amp; 21 &amp; 6\\</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag &amp; 21 &amp; 6\\</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt; \end{tabular}</span></span></code></pre></div>
<p>“<code>SPECIAL</code>” and “<code>ENVIRONMENT</code>” label the types
of items. The table environment contains the environment name, and a
<code>"LaTeX2"</code> list containing all the content.</p>
<p>If we hadn’t known where we put it, we could find the table location
using <code><a href="../reference/finders.html">find_env()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/finders.html">find_env</a></span><span class="op">(</span><span class="va">parsed</span>, <span class="st">"tabular"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>We can extract the table, and use other functions to work with
it:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table</span> <span class="op">&lt;-</span> <span class="va">parsed</span><span class="op">[[</span><span class="fu"><a href="../reference/finders.html">find_env</a></span><span class="op">(</span><span class="va">parsed</span>, <span class="st">"tabular"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># Get the alignment options from the content</span></span>
<span><span class="fu"><a href="../reference/tableOption.html">columnOptions</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span></span>
<span><span class="co">#&gt; {l|r|r}</span></span>
<span><span class="fu"><a href="../reference/tablecell.html">tableCell</a></span><span class="op">(</span><span class="va">table</span>, <span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span> <span class="co"># The title counts as a row</span></span>
<span><span class="co">#&gt;  21</span></span>
<span><span class="fu"><a href="../reference/tablecell.html">tableCell</a></span><span class="op">(</span><span class="va">table</span>, <span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Model"</span></span>
<span><span class="va">table</span></span>
<span><span class="co">#&gt; ENVIRONMENT: \begin{tabular}{l|r|r}</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt;  Model &amp; mpg &amp; cyl\\</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt; Mazda RX4 &amp; 21 &amp; 6\\</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag &amp; 21 &amp; 6\\</span></span>
<span><span class="co">#&gt; \hline</span></span>
<span><span class="co">#&gt; \end{tabular}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="differences-from-toolsparselatex">Differences from <code>tools::parseLatex</code><a class="anchor" aria-label="anchor" href="#differences-from-toolsparselatex"></a>
</h2>
<p>The parser in this package is based on the one used by the base R
<code><a href="https://rdrr.io/r/tools/parseLatex.html" class="external-link">tools::parseLatex</a></code> function (which I also wrote, based on
other parsers in R). The output format is similar, but not compatible.
These are the main differences.</p>
<ul>
<li>In both this package and <code><a href="https://rdrr.io/r/tools/parseLatex.html" class="external-link">tools::parseLatex</a></code>, the result
of calling the parser is a list of items.<br>
</li>
<li>The list has class <code>"LaTeX2"</code> in this package, and class
<code>"LaTeX"</code> in <code><a href="https://rdrr.io/r/tools/parseLatex.html" class="external-link">tools::parseLatex</a></code>.</li>
<li>All items have an attribute returned by the <code><a href="../reference/names.html">latexTag()</a></code>
function identifying the type of item. In this package the possible tags
are</li>
</ul>
<table class="table">
<thead><tr class="header">
<th align="left">Tag</th>
<th align="left">Description</th>
<th align="left">Type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BLOCK</td>
<td align="left">A block enclosed in curly braces</td>
<td align="left">list</td>
</tr>
<tr class="even">
<td align="left">COMMENT</td>
<td align="left">A LaTeX comment</td>
<td align="left">character</td>
</tr>
<tr class="odd">
<td align="left">DISPLAYMATH</td>
<td align="left">A display math block</td>
<td align="left">list</td>
</tr>
<tr class="even">
<td align="left">ENVIRONMENT</td>
<td align="left">A LaTeX environment</td>
<td align="left">list</td>
</tr>
<tr class="odd">
<td align="left">MACRO</td>
<td align="left">A LaTeX macro</td>
<td align="left">character</td>
</tr>
<tr class="even">
<td align="left">MATH</td>
<td align="left">An inline math block</td>
<td align="left">list</td>
</tr>
<tr class="odd">
<td align="left">SPECIAL</td>
<td align="left">A non-alphabetic character</td>
<td align="left">character</td>
</tr>
<tr class="even">
<td align="left">TEXT</td>
<td align="left">Text (consisting of letters only)</td>
<td align="left">character</td>
</tr>
<tr class="odd">
<td align="left">VERB</td>
<td align="left">A verbatim environment</td>
<td align="left">character</td>
</tr>
<tr class="even">
<td align="left">DEFINITION</td>
<td align="left">A command or environment definition</td>
<td align="left">list</td>
</tr>
</tbody>
</table>
<ul>
<li>The <code><a href="https://rdrr.io/r/tools/parseLatex.html" class="external-link">tools::parseLatex()</a></code> parser does not have the
<code>SPECIAL</code>; such characters are included in <code>TEXT</code>.
It also doesn’t have the <code>DEFINITION</code> tag. Definitions are
treated as regular macros, which sometimes leads to parsing errors.</li>
<li>This parser stops when it reaches <code>\end{document}</code>, just
as LaTeX does. The <code><a href="https://rdrr.io/r/tools/parseLatex.html" class="external-link">tools::parseLatex()</a></code> parser continues
parsing beyond that, often leading to parsing errors as it tries to
parse things that LaTeX would ignore.</li>
<li>In both implementations, some items (<code>COMMENT</code>,
<code>MACRO</code>, <code>SPECIAL</code>, <code>TEXT</code>, and
<code>VERB</code>) are stored as length 1 character vectors; the others
are stored as lists of items corresponding to their content.<br>
</li>
<li>The list storage is different between the two. The
<code><a href="https://rdrr.io/r/tools/parseLatex.html" class="external-link">tools::parseLatex()</a></code> function stores some lists in two
levels (e.g. the content of an environment named <code>item</code> would
be in <code>item[[2]]</code>), while in this package, all lists contain
the content directly (e.g. the content of that environment would be in
<code>item</code> itself).</li>
<li>This package marks all items with class <code>"LaTeX2item"</code>.
<code><a href="https://rdrr.io/r/tools/parseLatex.html" class="external-link">tools::parseLatex()</a></code> does not assign a class to items.</li>
<li>This package provides print methods for class
<code>"LaTeX2item"</code> so that individual items print nicely.</li>
<li>Parsing errors are reported more informatively by this package.</li>
<li>This parser supports “magic comments”. See the next section for
details.</li>
<li>This parser is more flexible in handling <code>verb</code> macros
like <code>\Sexpr</code>. The <code><a href="https://rdrr.io/r/tools/parseLatex.html" class="external-link">tools::parseLatex()</a></code> parser
assumed there would be no braces within the macro (which is the case for
legal <code><a href="https://rdrr.io/r/utils/Sweave.html" class="external-link">Sweave()</a></code> source). This parser assumes any braces
within the macro are balanced, e.g. this would be legal:<br><br><code>\Sexpr{1 + {x &lt;- 2; x + 1}}</code><br><br>
whereas unbalanced braces would not be.</li>
</ul>
<p>As mentioned above, <code><a href="../reference/parseLatex_fn.html">parseLatex()</a></code> does a little bit more
than parsing. Both versions recognize LaTeX environments and verbatim
code.</p>
<p>The parser in this package also takes special action when it sees the
<code>document</code> environment: it stops parsing at
<code>\end{document}</code>. (You can use the
<code><a href="../reference/get_leftovers.html">get_leftovers()</a></code> function to see what parts of the input
were skipped.)</p>
<p>It also changes the rules a bit when it sees macros defining things:
<code>\newenvironment</code>, <code>\renewenvironment</code>,
<code>\newcommand</code>, <code>\renewcommand</code> and
<code>\providecommand</code>. The arguments to these macros are parsed
but not interpreted, allowing definitions to parse without triggering a
syntax error. For example:</p>
<pre><code>\newenvironment{newenv}{\begin{oldenv}}{\end{oldenv}}</code></pre>
<p>The <code>\begin{oldenv}</code> part of the definition shouldn’t be
interpreted here as the start of an <code>oldenv</code> environment,
because <code>\end{oldenv}</code> isn’t in the same <code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">{}</a></code>
block.</p>
<p>One plain TeX version of these macros is <code>\def</code>. It is
recognized and an attempt is made to handle it, but there’s some really
arcane syntax possible with <code>\def</code>. If you use that, it
probably won’t be parsed properly. Stick with simple syntax like</p>
<pre><code>\def\bea{\begin{eqnarray*}}</code></pre>
<p>and you should be okay.</p>
</div>
<div class="section level2">
<h2 id="magic-comments">Magic Comments<a class="anchor" aria-label="anchor" href="#magic-comments"></a>
</h2>
<p>The <code><a href="../reference/parseLatex_fn.html">parseLatex::parseLatex()</a></code> parser can parse most LaTeX
inputs, but not all. To allow it to be used on files that contain
unsupported syntax, it allows “magic comments” to be inserted to control
its actions.</p>
<p>Several LaTeX editors support magic comments of the form
<code>% !TEX ...</code>, and those were the model for
<code>parseLatex</code> magic comment support. There are 4 magic
comments supported in this parser:</p>
<ul>
<li>
<code>% !parser off</code> This tells the parser to absorb all
following text as part of the comment, so anything that would be classed
as a parsing error is never seen.</li>
<li>
<code>% !parser on</code> This tells it to resume normal
parsing.</li>
<li>
<code>% !parser verb [name]</code> This tells the parser to add the
name to the list of macros holding verbatim text, i.e. the list given by
the <code>verb</code> argument when <code><a href="../reference/parseLatex_fn.html">parseLatex()</a></code> was
called. The name should include the backslash, e.g.<br><br><code>% !parser verb \Sexpr</code><br><br>
would add the default verb macro.</li>
<li>
<code>% !parser verbatim [name]</code> This tells the parser to add
the name to the list of environments holding verbatim text, i.e. the
list given by the <code>verbatim</code> argument. For example<br><br><code>% !parser verbatim Sinput</code><br><br>
would add one of the default verbatim environments.</li>
</ul>
<p>The parser is quite strict about the format of the magic comments.
The whitespace between parts of it must be spaces, not tabs, and nothing
else can appear in the comment after the magic text other than more
spaces.</p>
</div>
<div class="section level2">
<h2 id="work-in-progress">Work in progress!<a class="anchor" aria-label="anchor" href="#work-in-progress"></a>
</h2>
<p>This is a work in progress, so if you have a use for something like
this and need help, post an “issue” on the Github page: <a href="https://github.com/dmurdoch/parseLatex" class="external-link uri">https://github.com/dmurdoch/parseLatex</a> .</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Duncan Murdoch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
